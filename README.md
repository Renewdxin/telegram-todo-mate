# Telegram Bot 对接

本文档主要描述 Telegram Bot 与各功能模块之间的对接方式，目前包含的模块有"待办事项功能"，后续将陆续添加更多功能模块，各功能模块在文档中独立描述，便于扩展与维护。

---

## 目录

1. [待办事项功能](#待办事项功能)
2. …… （未来新增功能模块）

---

## 待办事项功能

该模块主要实现了用户提交待办事项、定时提醒、任务状态更新（完成/删除）以及设置修改等功能。

### 1. 任务创建

- **用户输入格式**  
  格式：
  \[
  \texttt{时间, end\_time, todo\_name}
  \]
  - **时间**：任务创建的时间。
  - **end\_time**：任务截止时间（可为空，表示无截止时间）。
  - **todo\_name**：任务名称。

- **Bot 返回**  
  Bot 根据用户输入创建任务后返回一个任务标识符（todo\_id），该标识符用于后续对任务的状态更新和操作。

---

### 2. 定时提醒

Bot 会在每天早上9点发送两条消息提醒用户：

1. **未完成事项提醒 (Left to Do):**  
   消息格式示例：
   ```txt
   left to do:
   1. todo_name1 还剩{n}天截止
   2. todo_name2 还剩{n}天截止
   PS: "还剩{n}天截止" 表示截止时间距离当前日期还剩余的天数，当任务未设置截止时间时，该部分信息不显示。
   ```

2. **当天截止事项提醒 (Today To Do):**  
   消息格式示例：
   ```txt
   today to do:
   1. todo_name3 还剩{n}天截止
   2. todo_name4 还剩{n}天截止
   PS: 仅显示当天截止的任务，格式说明同上。
   ```

---

### 3. 标记任务完成

- **用户输入格式**  
  格式：
  ```txt
  done todo_id
  ```
  其中 \(\texttt{todo\_id}\) 为任务的唯一标识符。

- **Bot 返回**  
  Bot 执行标记操作后返回相应的成功或失败提示。

---

### 4. 删除任务

- **用户输入格式**  
  格式：
  ```txt
  delete todo_id
  ```

- **Bot 返回**  
  Bot 根据指令删除对应任务，并反馈删除操作是否成功。

---

### 5. 修改设置

- **用户输入格式**  
  格式：
  ```txt
  change time 新时间
  ```
  例如：若希望将提醒时间改为上午8点，指令为：
  ```txt
  change time 08:00
  ```

- **Bot 返回**  
  Bot 根据设置更改成功或失败返回对应提示。

---

## 附加说明

- **错误处理**
  - 当用户输入格式错误或指令执行失败时，Bot 会返回错误提示，提醒用户检查输入格式后重试。

- **时间格式**
  - 所有输入时间均建议采用统一格式（例如24小时制 HH:mm），确保格式的一致性，避免解析错误。

- **任务标识 (todo\_id)**
  - 任务创建后返回的 \(\texttt{todo\_id}\) 既是任务的唯一识别码，也是后续完成、删除等操作的依据。

- **定时提醒机制**
  - 定时消息的发送依赖于服务器端的任务调度（例如 cron 或其他调度器），需确保服务器时间准确无误。

---

## 系统架构概述

1. **用户指令处理模块**  
   解析用户输入指令，并调用相应业务逻辑（如任务创建、状态更新等）。

2. **任务管理模块**  
   负责任务的存储、状态维护（未完成/已完成）及数据的检索与更新（例如剩余天数计算）。

3. **定时提醒模块**  
   配合任务调度器按时向用户发送提醒消息。

---

通过以上文档结构，当前待办事项功能作为一个独立模块展示，未来新增其他功能只需在「目录」中添加新模块章节，并在文档中提供相应说明，便于模块化管理和持续扩展。


